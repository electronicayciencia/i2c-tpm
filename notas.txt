Self-tests:
  - The deterministic RNG produces blocks of 160 bits. Each subsequent 160-bit block output from the RNG is compared to the previous block. The test fails if any two compared 160-bit sequences are equal.

Physical Presence authorization may be accomplished by setting a logic high voltage on the hardware pin at the time a service request is sent to the module (assertion of tpmGo bit in the TIS register [5]). 

Failed Authentication Attempts Counter: The TOE accumulates the total number of failed authorization attempts on any entity in the FAILCOUNT register.

The TOE contains an active metal shield that covers the internal TPM circuitry and memory components. Cutting, removing or modifying the shield layer will cause the TPM to Reset and enter a FAIL mode.


TPM Structures (.c):
https://chromium.googlesource.com/chromiumos/third_party/tpm-emulator/+/6b062e43d7bbc59af1aca33cb01393a4ecf1a280/tpm/tpm_structures.h

https://trustedcomputinggroup.org/wp-content/uploads/TCG-TPM-I2C-Interface-Specification-v1.00.pdf


Figure 3. Typical hardware implementation (TSSOP28 package): de ST. Pines más imporantes en comun con Atmel.


A Practical Guide to Trusted Computing: Writing a TPM Device Driver
https://www.informit.com/articles/article.aspx?p=1154764&seqNum=3



 - Locality 4: Trusted hardware component. This is used by the D-CRTM to establish the Dynamic RTM. 125 2
 - Locality 3: Auxiliary components. Use of this is optional and, if used, it is implementation dependent.
 - Locality 2: Dynamically Launched OS (Dynamic OS) “runtime” environment.
 - Locality 1: An environment for use by the Dynamic OS.
 - Locality 0: The Static RTM, its chain of trust and its environment.
 - Locality None: This locality is defined for using TPM 1.1 type I/O-mapped addressing. The TPM behaves as if Locality 0 is selected.

TPM 1.1b -> commands (vendor specific)
TPM 1.2 -> memory mapping
  FED4 L000 - FED4 LFFF -> L is locality (0-4).



I2C:
The default 7-bit I2C device address is 0x2E, the 8th bit indicates the data direction.
 - 0x5D for an I2C read request and 
 - 0x5C for an I2C write transmission.

Is required that the bus master supports the clock stretching mechanism

The I2C-TPM SHALL support a supply and I/O voltage of 1.8V or 3.3V.

PIRQ# = PCI-IRQ. IRQ = 0-15; PIRQ > 15

Multi byte: In all cases, except the TPM_STS register, the access to such multi-byte registers is only possible from the register base address.

I2C registers:
0x00         TPM_LOC_SEL
0x04         TPM_ACCESS  
0x18 – 0x1B	 TPM_STS
0x24         TPM_DATA_FIFO
0x30         TPM_I2C_INTERFACE_CAPABILITY
0x48         TPM_DID_VID
0x4C         TPM_RID 

Reading of the burstCount may be critical when read in single bytes because the low part might change when the high part is read (and vice versa). Therefore it is strongly recommended to read the whole burstCount in one cycle.


Lo datos se escriben a TPM_DATA_FIFO en rafagas de Burstcount escrituras.










sudo apt-get install tpm-quote-tools tpm-tools-pkcs11

Repos para mirar:

https://github.com/Rohde-Schwarz/TPMManager






Mirar cómo es el TPM reset attack - Described independently by Kauer and Sparks


ATMEL's AT97SC3204T I2C TPM
https://github.com/theopolis/tpm-i2c-atmel


System Design Manufacturing Recommendations for Atmel TPM Devices - Microchip
http://ww1.microchip.com/downloads/en/AppNotes/Atmel-8882-TPM-System-Design-Mftg-Recommendations-ApplicationNote.pdf







sudo tpmtoken_init -l debug
A new TPM security officer password is needed. The password must be between 4 and 8 characters in length.
Enter new password: 12341234

error













--------------------



sudo apt-get install gnutls-bin
viene el manual para tpmtool pero no el binario.

tpmtool is missing
https://bugs.launchpad.net/ubuntu/+source/gnutls28/+bug/1702755

In this section we present the Trusted Platform Module (TPM) support 
in @acronym{GnuTLS}. Note that this functionality is disabled by default
because the @code{trousers} libraries GnuTLS depends on
are under the Common Public License which is not compatible with the GPL 
license. By disabling this feature by default we ensure that the GnuTLS library can
be linked by both GPL and non-GPL programs, but you can enable this option
during the library configuration.



apt-get source gnutls-bin
./configure --with-included-unistring --with-tpm





































